.subckt ctl reset Z id[31:26] ra2sel bsel alufn_buf[4:0] wdsel[1:0] werf moe wr pcsel[2:0] asel wasel
//... your control ROM and other circuitry here ...
xconnect connect id[31:26] op[5:0]

xinv inverter op[5:0] nop[5:0]

//wr and ra2sel
xxwr nor3 op[5] op[2] op[1] xwra
//xxwr1 nand3 op[4:3] op[0] nxwrb
//xinv inverter nxwrb xwrb
xxwr1 nor3 nop[4:3] nop[0] xwrb
xxwr2 nand2 xwra xwrb nxwr

xand nor2 nxwr reset wr
xra2sel inverter nxwr ra2sel

// asel
xasel1 nand3 nop[5] op[4:3] asela
xasel2 nand3 op[2:0]  aselb
xasel3 nor2 asela aselb asel
// 543210
// abcdef
// werf 011001
xwerf1 nor3 op[5] op[2] op[1] werfa
xwerf2 nor3 nop[4] nop[3] nop[0] werfb
xwerf3 nand2 werfa werfb werf
// moe
xmoe xnor2 op[1:0] moe

//wdsel 011000 or 011111

xwdseloa nand3 nop[5] op[4:3] wdseloa
xwdselob nor3 nop[2:0] wdselob
xwdseloc nor3 op[2:0] wdseloc
xwdselod nor2 wdselob wdseloc wdselod

xwdself nor2 wdseloa wdselod wdsel[1]

xpcsel2a nand3 op[4:2] xpcsel2a
xpcsel2b nand2 nop[5] nop[1] xpcsel2b
xpcsel2 nor2 xpcsel2a xpcsel2b xpcsel[2]

xconnectopa buffer_2 op[5:0] a b c d e f
xconnectnopa buffer_2 nop[5:0] na nb nc nd ne nf
xpcsel1a nor4 a nd e nf pcsel1a
xpcsel1b nor4 na nd ne nf pcsel1b
xpcsel1c nor3 a d ne pcsel1c
xpcsel1d nor3 c d ne pcsel1d
xpcsel1e nor3 a ne f pcsel1e
xpcsel1f nor2 a b pcsel1f
xpcsel1g nor2 a c pcsel1g
xpcsel1aa nor4 pcsel1a pcsel1b pcsel1c pcsel1d pcsel1aa
xpcsel1ab nor3 pcsel1e pcsel1f pcsel1g pcsel1ab
xpcsel1 nand2 pcsel1aa pcsel1ab xpcsel[1]

.connect pcsel0a pcsel1b
.connect pcsel1d pcsel0b
.connect pcsel1e pcsel0c
xpcsel0d nor3 a nd e pcsel0d
.connect pcsel1f pcsel0e
.connect pcsel1g pcsel0f
xpcsel0aa nor3 pcsel0a pcsel0b pcsel0c pcsel0aa
xpcsel0ab nor3 pcsel0d pcsel0e pcsel0f pcsel0ab
xpcsel0 nand2 pcsel0aa pcsel0ab xpcsel[0]

xwasela nand4 a d e f wasela
xwaselb nand3 na e nf waselb
xwaselc nand2 na nb waselc
xwaseld nand2 na nc waseld
xwasel nand4 wasela waselb waselc waseld wasel

xbsela nand4 b c nd ne bsela
xbselb nand4 a b c nd bselb
xbselc nand4 a b d nf bselc
xbseld nand3 a b ne bseld
xbsel nand4 bsela bselb bselc bseld bsel

xalufn4aa nor3 a nb nc alufn4aa
xalufn4ab nor3 nd ne nf alufn4ab
xalufn4a nand2 alufn4aa alufn4ab alufn4a
xalufn4b nand3 a c nd alufn4b ///////////////////////
xalufn4 nand2 alufn4a alufn4b alufn[4]

xalufn3a connect alufn4a alufn3a
xalufn3b nand4 a d e nf alufn3b
xalufn3c nand4 a c nd f alufn3c
xalufn3d nand3 a c ne alufn3d
xalufn3 nand4 alufn3a alufn3b alufn3c alufn3d alufn[3]

xalufn2a nand3 c ne nf alufn2a
xalufn2b nand2 nc nd alufn2b//
xalufn2c nand2 e f alufn2c
xalufn2d nand2 c d alufn2d
xalufn2aa nand4 alufn2a alufn2b alufn2c alufn2d alufn2aa
xalufn2 nor2 alufn2aa na alufn[2]

xalufn1a nand3 c d ne alufn1a
xalufn1b nand3 a e f alufn1b
xalufn1c nand2 na nb alufn1c
xalufn1d nand2 na nd alufn1d
xalufn1e nand2 nc nd alufn1e//

xalufn1f nand2 na ne alufn1f
xalufn1g nand2 na nf alufn1g
xalufn1h nand2 ne nf alufn1h
xalufn1i nand2 nc e alufn1i
xalufn1aa nand3 alufn1a alufn1b alufn1c alufn1aa
xalufn1ab nand3 alufn1d alufn1e alufn1f alufn1ab
xalufn1ac nand3 alufn1g alufn1h alufn1i alufn1ac
xalufn1 nor3 alufn1aa alufn1ab alufn1ac alufn[1]

xalufn0a nor3 na c nf alufn0a
xalufn0b nor3 na c ne alufn0b
xalufn0c nor3 na ne nf alufn0c
xalufn0d nor3 na c nd alufn0d
xalufn0e nor3 na nd nf alufn0e
xalufn0f nor3 na nd ne alufn0f
xalufn0aa nor3 alufn0a alufn0b alufn0c alufn0aa
xalufn0ab nor3 alufn0d alufn0e alufn0f alufn0ab
xalufn0 nand2 alufn0aa alufn0ab alufn[0]
xalufnbuf buffer_4 alufn[4:0] alufn_buf[4:0]
xwdsel0a nand3 a d nf wdsel0a
xwdsel0b nand3 a c nd wdsel0b
xwdsel0c nand2 a ne wdsel0c
xwdsel0 nand3 wdsel0a wdsel0b wdsel0c wdsel[0]



xconpcsel2 connect pcsel[2] gnd
// z logic
xamibranching nand2 xpcsel[2] xpcsel[0] nbranching
xwhichz xor2 xpcsel[1] Z thisZ
xandpcsel1 nand2 nbranching xpcsel[1] npcsel[1]
xinvpcsel1 inverter npcsel[1] pcsel[1]
xmuxpcsel mux2 nbranching thisZ xpcsel[0] pcsel[0]
.ends
